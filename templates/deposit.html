{% extends 'base.html' %}

{% block title %}Deposit Funds{% endblock %}

{% block content %}
<div class="container py-4">
    <h2 class="mb-4 text-primary"><i class="fas fa-wallet me-2"></i>Deposit Funds</h2>

    <form method="POST" class="needs-validation" novalidate>
        <div class="mb-3">
            <label for="account" class="form-label">Select Account:</label>
            <select name="account_id" id="account" class="form-select" required>
                {% for account in accounts %}
                <option value="{{ account.id }}">
                    {{ account.account_number }} â€” ${{ "{:,.2f}".format(account.balance) }}
                </option>
                {% endfor %}
            </select>
        </div>

        <div class="mb-3">
            <label for="amount_display" class="form-label">Amount:</label>
            <input type="text" id="amount_display" class="form-control" placeholder="Enter amount" required>
            <input type="hidden" name="amount" id="amount">
        </div>

        <div class="mb-3">
            <label for="description" class="form-label">Description (Optional):</label>
            <input type="text" name="description" id="description" class="form-control" placeholder="Enter description">
        </div>

        <button type="submit" class="btn btn-success">
            <i class="fas fa-wallet me-2"></i> Deposit
        </button>
    </form>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
    const amountDisplay = document.getElementById("amount_display");
    const amountHidden = document.getElementById("amount");

    amountDisplay.addEventListener("input", function () {
        let value = this.value.replace(/[^0-9.]/g, ""); // keep only numbers and dot
        if (!value) {
            amountHidden.value = "";
            this.value = "";
            return;
        }

        let parts = value.split(".");
        parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ","); // comma formatting
        this.value = parts.join(".");
        amountHidden.value = value; // raw numeric value for backend
    });
});
</script>
{% endblock %}
